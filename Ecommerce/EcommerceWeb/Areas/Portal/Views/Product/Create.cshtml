@{
    ViewData["Title"] = "Create";
}
<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    "ai-blue": "#10a37f",
                    "ai-dark": "#202123",
                    "ai-light": "#f7f7f8",
                    "ai-gray": "#343541",
                },
            },
        },
    };
</script>
<style>
    .gradient-bg {
        background: linear-gradient(135deg, #10a37f 0%, #1a73e8 100%);
    }

    .sidebar {
        transition: all 0.3s ease;
    }

    .sidebar-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .sidebar-link.active {
        background-color: rgba(255, 255, 255, 0.2);
    }

    .table-row:hover {
        background-color: #f0fdf4;
    }

    .image-preview {
        max-height: 120px;
        object-fit: contain;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(16, 163, 127, 0.2);
    }

    .discount-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #ef4444;
        color: white;
        padding: 2px 8px;
        border-radius: 9999px;
        font-size: 12px;
        font-weight: bold;
    }

    .rating-stars {
        color: #fbbf24;
    }

    .pulse-animation {
        animation: pulse 2s infinite;
    }
    @@keyframes pulse {
        0%

    {
        box-shadow: 0 0 0 0 rgba(16, 163, 127, 0.4);
    }

    70% {
        box-shadow: 0 0 0 10px rgba(16, 163, 127, 0);
    }

    100% {
        box-shadow: 0 0 0 0 rgba(16, 163, 127, 0);
    }

    }
</style>
<!-- Main Content -->
<div class="flex-1 flex flex-col overflow-hidden">
    <!-- Top Navigation -->
    <header class="bg-white shadow-sm">
        <div class="flex items-center justify-between px-6 py-3">
            <div class="flex items-center">

                <h2 class="text-xl font-semibold text-gray-800">Product Management</h2>
            </div>

            <div class="flex items-center space-x-4">
                <div class="relative">
                    <button class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-bell"></i>
                        <span class="absolute top-0 right-0 h-2 w-2 rounded-full bg-red-500"></span>
                    </button>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-gray-300 mr-2 overflow-hidden">
                        <img src="https://via.placeholder.com/32" alt="Admin" class="w-full h-full object-cover">
                    </div>
                    <span class="text-sm font-medium">Admin</span>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Content Area -->
    <main class="flex-1 p-6">
        <form id="productWizardForm" class="max-w-7xl mx-auto px-6 pb-10 bg-white rounded-lg shadow p-4">
            <!-- STEP 1 – GENERAL INFO -->
            <section class="wizard-step" data-title="General">
                <h2 class="text-lg font-semibold mb-6">General Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-h-[600px] overflow-y-auto ">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="productName">Product Name *</label>
                        <input id="productName"
                               type="text"
                               required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ai-blue focus:border-ai-blue" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="productSKU">SKU *</label>
                        <input id="productSKU"
                               type="text"
                               required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ai-blue focus:border-ai-blue" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="productCategory">Category *</label>
                        <select id="productCategory"
                                required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ai-blue focus:border-ai-blue">
                            <option value="">Select Category</option>
                            <option value="AI Tools">AI Tools</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Health">Health</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="productStatus">Status *</label>
                        <select id="productStatus"
                                required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ai-blue focus:border-ai-blue">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="draft">Draft</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="productDescription">Product Description</label>
                        <textarea id="productDescription"
                                  rows="5"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ai-blue focus:border-ai-blue"></textarea>
                    </div>
                    <div class="md:col-span-2 attr-parent"></div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium mb-1">Attributes</label>
                        <div class="space-y-2" id="variant-attributes-container">
                            <!-- Attributes will be added here -->
                        </div>
                        <button type="button"
                                class="text-sm text-ai-blue mt-2 flex items-center add-attribute-btn">
                            <i class="fas fa-plus mr-1"></i> Add Attribute
                        </button>
                    </div>
                </div>
              
            </section>

            <!-- STEP 2 – VARIANTS -->
            <section class="wizard-step hidden" data-title="Variants">
                <h2 class="text-lg font-semibold mb-6">Product Variants</h2>
                <p class="text-gray-600 mb-4 text-sm">
                    Add different variants with their pricing, images, and attributes.
                </p>

                <!-- Variant Content -->
                <div id="variantContentContainer" class="max-h-[600px] overflow-y-auto pr-2">
                    @* <!-- Default message when no variants -->
                    <div id="noVariantsMessage" class="text-center py-8 text-gray-500">
                        <i class="fas fa-box-open text-4xl mb-2"></i>
                        <p>No variants added yet. Click the button below to add your first variant.</p>
                    </div> *@
                   
                </div>

            </section>

            <!-- STEP 3 – REVIEW -->
            <section class="wizard-step hidden" data-title="Review">
                <h2 class="text-lg font-semibold mb-6">Review Product</h2>
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="font-medium text-gray-900 mb-4">General Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-500">Product Name</p>
                            <p id="reviewProductName" class="font-medium">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">SKU</p>
                            <p id="reviewSKU" class="font-medium">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Category</p>
                            <p id="reviewCategory" class="font-medium">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Status</p>
                            <p id="reviewStatus" class="font-medium">-</p>
                        </div>
                    </div>
                    <div class="mt-4">
                        <p class="text-sm text-gray-500">Description</p>
                        <p id="reviewDescription" class="font-medium">-</p>
                    </div>
                    <div class="mt-4">
                        <p class="text-sm text-gray-500">Images</p>
                        <div class="grid grid-cols-4 gap-2 mt-2" id="reviewImagesGrid"></div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6 mb-6" id="reviewVariantsContainer">
                    <h3 class="font-medium text-gray-900 mb-4">Variants</h3>
                    <p class="text-gray-500 text-sm">No variants added</p>
                </div>

                <button type="submit"
                        class="gradient-bg text-white px-6 py-3 rounded-md font-medium mt-4 w-full md:w-auto">
                    Save Product
                </button>
            </section>

            <!-- Navigation Buttons -->
            <div class="mt-8 flex justify-between items-center border-t pt-6 sticky bottom-0">
                <button type="button"
                        id="prevStepBtn"
                        class="px-4 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-100 disabled:opacity-40">
                    <i class="fas fa-chevron-left mr-1"></i> Previous
                </button>
                <button type="button"
                        id="nextStepBtn"
                        class="px-4 py-2 gradient-bg text-white rounded-md text-sm">
                    Next <i class="fas fa-chevron-right ml-1"></i>
                </button>
            </div>
        </form>

    </main>
   
    

    <template id="attribute-row-template">
        <div class="flex items-center space-x-2 mb-4 attribute-row">
            <input type="text"
                   placeholder="Attribute (e.g., Color)"
                   class="attr-name w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ai-blue focus:border-ai-blue" />
            <input type="text"
                   placeholder="Value (e.g., Red)"
                   class="attr-value w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ai-blue focus:border-ai-blue" />
            <button type="button"
                    class="text-red-500 hover:text-red-700 remove-attribute-btn">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </template>
    <template id="variant-content-template">
        <div class="variant-block border border-gray-200 rounded-lg p-6 mb-6 shadow relative">

            <h3 class="text-md font-semibold mb-4">Variant</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Variant Name *</label>
                    <input type="text" class="variant-name w-full px-3 py-2 border border-gray-300 rounded-md" />
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">SKU *</label>
                    <input type="text" class="variant-sku w-full px-3 py-2 border border-gray-300 rounded-md" />
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Price *</label>
                    <input type="number" class="variant-price w-full px-3 py-2 border border-gray-300 rounded-md" />
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Quantity *</label>
                    <input type="number" class="variant-qty w-full px-3 py-2 border border-gray-300 rounded-md" />
                </div>
            </div>
            <div class="flex flex-wrap gap-3 p-4 bg-white border border-gray-200 rounded-lg shadow-sm mb-4 varient-attributes">
                
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Variant Images</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 flex flex-col items-center text-center">
                    <i class="fas fa-cloud-upload-alt text-2xl text-gray-400 mb-2"></i>
                    <p class="text-sm text-gray-500">Upload variant-specific images</p>
                    <input type="file" multiple accept="image/*" class="hidden variant-images-input" />
                    <button type="button" class="mt-2 bg-blue-600 text-white px-3 py-1 rounded-md text-xs variant-images-btn">
                        Browse Images
                    </button>
                </div>
                <div class="grid grid-cols-4 gap-2 mt-2 variant-images-preview"></div>
            </div>
        </div>
    </template>
    <template id="review-variant-template">
        <div class="variant-card">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <p class="text-sm text-gray-500">Variant Name</p>
                    <p class="font-medium review-variant-name">-</p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">SKU</p>
                    <p class="font-medium review-variant-sku">-</p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Price</p>
                    <p class="font-medium review-variant-price">-</p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Stock</p>
                    <p class="font-medium review-variant-stock">-</p>
                </div>
            </div>
            <div class="mt-4">
                <p class="text-sm text-gray-500">Attributes</p>
                <div class="review-variant-attributes mt-1"></div>
            </div>
            <div class="mt-4">
                <p class="text-sm text-gray-500">Images</p>
                <div class="grid grid-cols-4 gap-2 mt-2 review-variant-images"></div>
            </div>
        </div>
    </template>

</div>
<!-- Script -->
<script>
    
    let currentStep = 0;   
    let attributes = [];
    let varients = null;

    const wizard_steps= document.querySelectorAll(".wizard-step");
    const attr_parent = document.querySelector(".attr-parent");
    const variantContentContainer = document.querySelector("#variantContentContainer");
    const attribute_row_template = document.getElementById("attribute-row-template").content;
    const variant_content_template = document.getElementById("variant-content-template").content;

    document.getElementById("prevStepBtn").addEventListener("click", () => {
         wizard_steps.forEach((step)=>{
            step.classList.add("hidden");
        });
        if (currentStep > 0) {
            currentStep--;
        }
        wizard_steps[currentStep].classList.remove("hidden");
    });
    document.getElementById("nextStepBtn").addEventListener("click", () => {        
         
        if(currentStep == 0){
            attributes = generateAttributes();
            varients = generateVariants(attributes);
            populateVariant(varients);

        }else if(currentStep == 1){            
        
            wizard_steps[1].append(variant_content_template);
        }

        wizard_steps.forEach((step)=>{
            step.classList.add("hidden");
        });      
        
        if (currentStep < 2) {
            currentStep++
        }
        wizard_steps[currentStep].classList.remove("hidden");
    });
    document.querySelector(".add-attribute-btn").addEventListener("click", () => {       
        
        attr_parent.append(attribute_row_template.cloneNode(true));
    });
    attr_parent.addEventListener("click", (e) => {
      if (e.target.closest(".remove-attribute-btn")) {
        const row = e.target.closest(".attribute-row");
        if (row) row.remove();
      }
    });
    
    function generateAttributes(){
        var attribute_rows = attr_parent.querySelectorAll(".attribute-row");
        const raw_attributes = [];
        attribute_rows.forEach((row) => {
            const nameInput = row.querySelector(".attr-name");
            const valueInput = row.querySelector(".attr-value");

            const name = nameInput?.value?.trim() || "";
            const values = valueInput?.value?.split(",").map(v => v.trim()).filter(v => v) || [];

            raw_attributes.push({
                name: name,
                values: values
            });
        });
        return raw_attributes;
    }

    function generateVariants(attributes) {
        if (attributes.length === 0) return [[]];

        const [first, ...rest] = attributes;
        const combos = generateVariants(rest);

        return first.values.flatMap(value =>
            combos.map(combo => [{ name: first.name, value: value }, ...combo])
        );
    }

    function populateVariant(variants) {
        variants.forEach(variant => {
            // Clone the template properly
            const variantElement = variant_content_template.cloneNode(true);

            // Find the container for attributes
            const attrContainer = variantElement.querySelector(".varient-attributes");
            if (!attrContainer) return;

            // Render each attribute as a tag
            variant.forEach(attr => {
                const variantAttribute = `
                    <span class="inline-flex items-center gap-2 px-4 py-1.5
                                 bg-blue-50 text-blue-800 text-sm font-medium
                                 rounded-full shadow-sm border border-blue-200
                                 hover:shadow-md transition-shadow">
                        <span class="whitespace-nowrap">${attr.name.toUpperCase()}: ${attr.value.toUpperCase()}</span>
                    </span>`;
                attrContainer.insertAdjacentHTML("beforeend", variantAttribute);
            });

            // Append to main container
            variantContentContainer.appendChild(variantElement);
        });
    }

</script>
